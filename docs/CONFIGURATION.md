# ‚öôÔ∏è Configuration Guide

Complete reference for all Mission Control configuration options.

---

## Environment Variables

### Core (Required)

#### `CONVEX_DEPLOYMENT`
- **Type:** String
- **Required:** Yes
- **Generated by:** `npx convex dev`
- **Example:** `local:local-yourproject-abc123`
- **Description:** Your Convex deployment identifier. Auto-generated when you run `npx convex dev`.

#### `NEXT_PUBLIC_CONVEX_URL`
- **Type:** URL
- **Required:** Yes
- **Generated by:** `npx convex dev`
- **Example:** `http://127.0.0.1:3210` (dev) or `https://your-deployment.convex.cloud` (prod)
- **Description:** The URL where your Convex backend is accessible.

---

### Revenue Tracking (Optional)

#### `STRIPE_SECRET_KEY`
- **Type:** String (API key)
- **Required:** No
- **Example:** `sk_test_xxxxx` or `sk_live_xxxxx`
- **Description:** Stripe API secret key for revenue sync. Recommended: Use a **restricted key** with read-only permissions.
- **Get it:** [Stripe Dashboard ‚Üí API Keys](https://dashboard.stripe.com/apikeys)

#### `WHOP_API_KEY`
- **Type:** String (API key)
- **Required:** No
- **Example:** `apik_xxxxx`
- **Description:** Whop API key for syncing Whop product revenue.
- **Get it:** [Whop Apps Dashboard](https://whop.com/apps)

---

### AI Features (Optional)

#### `OPENAI_API_KEY`
- **Type:** String (API key)
- **Required:** No
- **Example:** `sk-proj-xxxxx`
- **Description:** OpenAI API key for generating agent memory summaries and AI-powered briefings.
- **Get it:** [OpenAI Platform ‚Üí API Keys](https://platform.openai.com/api-keys)
- **Models used:** `gpt-4o-mini` (cost-effective, fast)

---

### Ops Kernel (Optional)

#### `SUPABASE_URL`
- **Type:** URL
- **Required:** No (only for `/api/ops/*` endpoints)
- **Example:** `https://abcdefgh.supabase.co`
- **Description:** Your Supabase project URL.
- **Get it:** [Supabase Dashboard ‚Üí Project Settings ‚Üí API](https://supabase.com/dashboard/project/_/settings/api)

#### `SUPABASE_SERVICE_ROLE_KEY`
- **Type:** String (JWT)
- **Required:** No (only for `/api/ops/*` endpoints)
- **Example:** `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
- **Description:** Supabase service role key (server-side only, **never expose to client**).
- **‚ö†Ô∏è Security:** Do NOT use `NEXT_PUBLIC_*` prefix. This is a secret key!
- **Get it:** [Supabase Dashboard ‚Üí Project Settings ‚Üí API](https://supabase.com/dashboard/project/_/settings/api)

---

## Agent Configuration

Agents are defined in `convex/seed.ts` (for initial seed) and managed via the Convex database.

### Agent Schema

```typescript
{
  name: string,      // Agent name (e.g., "Jarvis")
  role: string,      // Agent role (e.g., "Squad Lead")
  emoji: string,     // Emoji icon (e.g., "üéØ")
  status: "active" | "idle" | "sleeping" | "error",
  currentTask: string,   // Current task description
  lastSeen: number,      // Timestamp (ms)
}
```

### Adding a New Agent

Edit `convex/seed.ts`:

```typescript
const agents = [
  {
    name: "YourAgent",
    role: "Your Role",
    emoji: "ü§ñ",
    status: "idle",
    currentTask: "Waiting for tasks",
    lastSeen: Date.now(),
  },
  // ... other agents
];
```

Then re-seed:
```bash
# Clear existing data (optional)
# Then re-seed
npx convex run seed:seed
```

### Updating Agent Status via API

```bash
curl -X POST https://your-domain.com/api/heartbeat \
  -H "Content-Type: application/json" \
  -d '{
    "name": "YourAgent",
    "status": "active",
    "currentTask": "Processing data"
  }'
```

---

## Metrics Configuration

Metrics are displayed in the bottom metrics bar.

### Default Metrics

Edit `src/components/MetricsBar.tsx`:

```typescript
const METRIC_CONFIG: Record<string, { 
  label: string; 
  icon: string; 
  format?: (v: number) => string 
}> = {
  emails_sent: { 
    label: "Emails Sent", 
    icon: "üìß" 
  },
  tweets_posted: { 
    label: "Tweets Posted", 
    icon: "üê¶" 
  },
  revenue: { 
    label: "Revenue", 
    icon: "üíµ", 
    format: (v) => `$${v.toLocaleString()}` 
  },
};
```

### Adding a Custom Metric

1. **Define in `MetricsBar.tsx`:**
   ```typescript
   custom_metric: { 
     label: "Custom Metric", 
     icon: "üéØ",
     format: (v) => `${v}x`  // Optional formatter
   }
   ```

2. **Initialize in `convex/seed.ts`:**
   ```typescript
   { key: "custom_metric", value: 0, updatedAt: Date.now() }
   ```

3. **Update via API:**
   ```bash
   curl -X POST https://your-domain.com/api/metric \
     -H "Content-Type: application/json" \
     -d '{"key":"custom_metric","value":100}'
   ```

---

## Task Configuration

Tasks are managed via the UI or API.

### Task Schema

```typescript
{
  title: string,           // Task title
  description?: string,    // Task description
  status: "inbox" | "in_progress" | "review" | "done",
  assignee?: string,       // Agent name
  priority: "P0" | "P1" | "P2",
  createdAt: number,       // Timestamp
  updatedAt: number,       // Timestamp
}
```

### Task Priorities

- **P0** - Critical (red badge)
- **P1** - High (yellow badge)
- **P2** - Normal (gray badge)

### Creating Tasks via API

```bash
curl -X POST https://your-domain.com/api/task-update \
  -H "Content-Type: application/json" \
  -d '{
    "title": "New Task",
    "description": "Task details",
    "status": "inbox",
    "assignee": "Jarvis",
    "priority": "P1"
  }'
```

---

## Database Schema

The Convex schema is defined in `convex/schema.ts`.

### Tables

#### `agents`
```typescript
{
  name: v.string(),
  role: v.string(),
  emoji: v.string(),
  status: v.union(v.literal("active"), v.literal("idle"), v.literal("sleeping"), v.literal("error")),
  currentTask: v.string(),
  lastSeen: v.number(),
}
```

#### `tasks`
```typescript
{
  title: v.string(),
  description: v.optional(v.string()),
  status: v.union(v.literal("inbox"), v.literal("in_progress"), v.literal("review"), v.literal("done")),
  assignee: v.optional(v.string()),
  priority: v.union(v.literal("P0"), v.literal("P1"), v.literal("P2")),
  createdAt: v.number(),
  updatedAt: v.number(),
}
```

#### `activities`
```typescript
{
  agent: v.string(),
  action: v.string(),
  detail: v.string(),
  timestamp: v.number(),
}
```

#### `metrics`
```typescript
{
  key: v.string(),
  value: v.number(),
  updatedAt: v.number(),
}
```

#### `revenue`
```typescript
{
  date: v.string(),
  amount: v.number(),
  product: v.string(),
  source: v.string(),
  stripePaymentId: v.optional(v.string()),
  metadata: v.optional(v.object({
    customer: v.optional(v.string()),
    subscription: v.optional(v.string()),
    currency: v.optional(v.string()),
  })),
  createdAt: v.number(),
}
```

---

## Styling Configuration

### Color Theme

Edit `src/app/globals.css`:

```css
:root {
  --background: #0a0a0a;
  --foreground: #e5e5e5;
  --accent: #3b82f6;  /* Blue */
  --success: #22c55e; /* Green */
  --warning: #f59e0b; /* Amber */
  --error: #ef4444;   /* Red */
}
```

### Status Colors

Agent statuses have visual indicators defined in `src/components/AgentCards.tsx`:

```typescript
const statusColors = {
  active: "shadow-[0_0_20px_rgba(34,197,94,0.5)]",  // Green glow
  idle: "shadow-[0_0_15px_rgba(59,130,246,0.3)]",   // Blue glow
  sleeping: "shadow-[0_0_10px_rgba(107,114,128,0.2)]", // Gray
  error: "shadow-[0_0_20px_rgba(239,68,68,0.5)]",   // Red glow
};
```

---

## Advanced: Custom API Routes

Add your own API endpoints in `src/app/api/`:

```typescript
// src/app/api/custom/route.ts
import { NextRequest, NextResponse } from 'next/server';

export async function POST(req: NextRequest) {
  const body = await req.json();
  
  // Your logic here
  
  return NextResponse.json({ success: true });
}
```

Call from agents:
```bash
curl -X POST https://your-domain.com/api/custom \
  -H "Content-Type: application/json" \
  -d '{"data":"value"}'
```

---

## Performance Tuning

### Polling Intervals

Activity feed auto-refreshes. Adjust in `src/components/ActivityFeed.tsx`:

```typescript
// Change polling interval (default: real-time via Convex)
// Convex handles real-time updates automatically!
```

### Limit Activity Log Size

Edit `convex/activities.ts`:

```typescript
export const list = query({
  handler: async (ctx) => {
    return await ctx.db
      .query("activities")
      .order("desc")
      .take(50); // Limit to 50 most recent
  },
});
```

---

## Security Best Practices

1. **Never commit `.env.local`** - It's in `.gitignore` by default
2. **Use restricted Stripe keys** - Read-only permissions for revenue sync
3. **Add authentication** - Protect API routes in production (NextAuth, Clerk, etc.)
4. **Rate limiting** - Add rate limits to public endpoints
5. **Input validation** - Validate all API inputs
6. **CORS** - Configure CORS for production

Example auth middleware:

```typescript
// src/middleware.ts
import { NextResponse } from 'next/server';

export function middleware(req) {
  const apiKey = req.headers.get('x-api-key');
  
  if (apiKey !== process.env.MISSION_CONTROL_API_KEY) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  
  return NextResponse.next();
}

export const config = {
  matcher: '/api/:path*',
};
```

---

Need more help? See [SETUP.md](SETUP.md), [DEPLOYMENT.md](DEPLOYMENT.md), or [CUSTOMIZATION.md](CUSTOMIZATION.md).
